{% extends "admin/base_site.html" %}
{% load static %}

{% block content %}
<div id="content-main">
    <!-- Date Filter Form -->
    <div class="module filtered" style="margin-bottom: 20px;">
        <form method="get" style="padding: 15px;">
            <div style="display: flex; gap: 15px; align-items: end;">
                <div>
                    <label for="filter">Filter:</label>
                    <select name="filter" id="filter" onchange="toggleCustomDates()">
                        <option value="all" {% if filter_type == 'all' %}selected{% endif %}>All time</option>
                        <option value="today" {% if filter_type == 'today' %}selected{% endif %}>Today</option>
                        <option value="custom" {% if filter_type == 'custom' %}selected{% endif %}>Custom range</option>
                    </select>
                </div>
                
                <div id="custom-dates" style="display: {% if filter_type == 'custom' %}flex{% else %}none{% endif %}; gap: 10px;">
                    <div>
                        <label for="date_from">From:</label>
                        <input type="date" name="date_from" id="date_from" value="{{ date_from }}">
                    </div>
                    <div>
                        <label for="date_to">To:</label>
                        <input type="date" name="date_to" id="date_to" value="{{ date_to }}">
                    </div>
                </div>
                
                <button type="submit" class="button">Apply</button>
            </div>
        </form>
    </div>

    <!-- Statistics Table -->
    <div class="module">
        <table style="width: 100%;">
            <thead>
                <tr>
                    <th>Brand</th>
                    <th style="text-align: right;">Total Registrations</th>
                </tr>
            </thead>
            <tbody>
                {% for item in stats %}
                <tr>
                    <td>{{ item.registration_brand__name|default:"No brand" }}</td>
                    <td style="text-align: right;">{{ item.total }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="2" style="text-align: center; padding: 20px;">No data available</td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr style="font-weight: bold; background-color: #f8f8f8;">
                    <td>TOTAL</td>
                    <td style="text-align: right;">{{ total }}</td>
                </tr>
            </tfoot>
        </table>
    </div>
</div>

<script>
function toggleCustomDates() {
    const filter = document.getElementById('filter').value;
    const customDates = document.getElementById('custom-dates');
    customDates.style.display = filter === 'custom' ? 'flex' : 'none';
}
</script>
{% endblock %}
